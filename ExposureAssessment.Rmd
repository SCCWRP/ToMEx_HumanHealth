---
title: "Human Microplastics Exposure Assessment"
author: "Scott Coffin"
date: "2/24/2021"
output:   
  html_document:
    code_folding: hide
    theme: journal
    toc: yes
    toc_float: yes
    toc_depth: 6
    number_sections: true
    includes:
     # after_body: footer.html
  word_document:
    toc: yes
---
#Setup
```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figs/',
                      warning=FALSE, message=FALSE,time_it = TRUE) #report
```

```{r library}
# Bimodal universal shape distribution for environmental microplastic from Kooi and Koelmans (2019)
library(truncnorm)
library(tidyverse)
library(MonteCarlo)# Monte Carlo Simulation 
library(gridExtra)
library(msm) ## rtnorm - get upper and lower limit of shape distribution
library(GeneralizedHyperbolic) ## normal-inverse Gaussian
library(skimr)
library(drc) #dose-response curves
library(qwraps2)
library(knitr)
library(papeR)
library(wesanderson)
library(janitor)
library(ggdark)
```


```{r import data}
# load tox data from RShiny app
#aoc_z <- readRDS(file = "aoc_z.Rda")
```

# Simulated distributions of particles

THe following is based on Mohamed Nor et al (2021). ES&T. 

Shape is defined as:
Simplifed equation for corey shape factor:

$CSF = H/sqrt(LW)$

Equation for abundance of particles based on density (two distributions). (Note that this is *equation 4* in Kooi and Koelmans (2019).) 


$y = f1(\frac{1}{sqrt(2pi()\sigma_1^2})e^{-(x-\mu_1)^2/2\sigma_1^2} + f2(\frac{1}{sqrt(2pi()\sigma_2^2})e^{-(x-\mu_2)^2/2\sigma_2^2}$

For polymer abundance, for the K&K2019 paper I used the fixed values from Burns & Boxall review, and went straight for density. Given these fixed relative abundances, you could calculate polymer type randomly for N particles via: 

pols <- c("PE", "PP", "PS")
rel.ab <- c(0.5, 0.3, 0.2)
n = 1000
sample(pols, size = n, prob = rel.ab, replace = TRUE)

Particle volume is determined according to shape as follows:

$V = \frac{\pi}{6}L^3CSF^2$

Where CSF = corey shape factor and L = length.

Particle mass is estimated as follows:

$m = pV*\frac{1}{1e12}*1000$

Where *m* is the mass (mg), *p* is density (g/cm^3), *V* is volume (um^3) - which is calculated by the cube of the length (um) of each particle, and additional conversion factors for mg to g (x1000) and cm^3 to um^3 (1e-12).

The parameters for fitting shape, density, and mass of microplastics particles for converting between number and mass are taken from Mohamed Nor et al (2021) (Table S7) for 'food' - as the authors reported that there are no significant differences between tap water and other food matrices for these parameters.

```{r, include=FALSE}
#rm(list=ls())
n = 10000
## Generate values for the three distributions
set.seed(123)

##++++++++++++++++++++++++++++++++++++++++
## SIZE DISTRIBUTION
##++++++++++++++++++++++++++++++++++++++++

xmin = 1 #UM
alpha = 2.5 #2.5 is preferred in unpublished Kooi et al. #use 1.6 as default

X.func <- function (X){
  success <- FALSE
  while (!success){
    U = runif(1, 0, 1)
    X = xmin*(1-U)^(1/(1-alpha))
    success <- X < 5000} ##should be smaller than 5000 um 
  return(X)
}

df <- data.frame(Size = numeric(0));

for(i in 1:n){
  X <- X.func()
  df <- rbind(df, X)
}

colnames(df) <- c("Size")

min(df$Size) ##20 um
max(df$Size) ##5000 um

##++++++++++++++++++++++++++++++++++++++++
## SHAPE DISTRIBUTION
##++++++++++++++++++++++++++++++++++++++++

mu1 <- 0.08
mu2 <- 0.44
sd1 <- 0.03
sd2 <- 0.19
lambda1 <- 0.06
lambda2 <- 0.94


#Sample N random uniforms U
U =runif(n)

#Sampling from the mixture
for(i in 1:n){
  if(U[i]<lambda1){
    df$Shape[i] = rtnorm(1,mu1,sd1, lower = 0, upper = 1)
  }else{
    df$Shape[i] = rtnorm(1,mu2,sd2, lower = 0, upper = 1)
  }
}

min(df$Shape) ##0
max(df$Shape) ##1

##++++++++++++++++++++++++++++++++++++++++
## DENSITY DISTRIBUTION
##++++++++++++++++++++++++++++++++++++++++

d.alpha = 73.8 #tail heaviness
d.beta = 69.9  #asymmetry
d.mu = 0.840   #location
d.delta = 0.0972 #scale

D.func <- function (D){
  success <- FALSE
  while (!success){
    D = rnig(1, mu = d.mu, alpha = d.alpha, beta = d.beta, delta = d.delta)
    success <- D < 2.63} ## include upper limit of 2.63, the max. 
  return(D)
}

Dens <- data.frame(Density = numeric(0));

for(i in 1:n){
  X <- D.func()
  Dens <- rbind(Dens, X)
}

colnames(Dens) <- c("Density")

df <- cbind(df, Dens)

##++++++++++++++++++++++++++++++++++++++++
## Polymer DISTRIBUTION
##++++++++++++++++++++++++++++++++++++++++

pols <- c("PE", "PP", "PS")
rel.ab <- c(0.5, 0.3, 0.2)
polymer <- sample(pols, size = n, prob = rel.ab, replace = TRUE)
df <- cbind(df, polymer)

df2 <- df %>%  
  mutate(size.category = factor(case_when(
    Size < 10 & Size >= 1 ~ "1µm < 10µm",
    Size < 100 & Size >= 10 ~ "10µm < 100µm",
    Size < 1000 & Size >= 100 ~ "100µm < 1mm",
    Size < 5000 & Size >= 1000 ~ "1mm < 5mm"))) %>% 
  mutate(mass.mg = Density * Size^3 * 1E-9) %>% 
  mutate(um3 = (Size^3))
```


```{r}
##++++++++++++++++++++++++++++++++++++++++
## Quick check results
##++++++++++++++++++++++++++++++++++++++++
p1 <- ggplot(df2, aes(x = Size, fill = size.category)) + geom_histogram(bins = 50, alpha = 0.7) + scale_x_log10()
p2 <- ggplot(df2, aes(x = Shape, fill = polymer)) + geom_histogram(bins = 50, alpha = 0.7)
p3 <- ggplot(df2, aes(x = Density, fill = polymer)) + geom_histogram(bins = 50, alpha = 0.7)
p4 <- ggplot(df2, aes(x = polymer, fill = polymer)) + geom_histogram(stat = "count")
p5 <- ggplot(df2, aes(x = log(1000*mass.mg), fill = size.category)) + geom_histogram(bins = 50, alpha = 0.7) + scale_x_continuous(name = "log10(Mass, mg)")

grid.arrange(p1,
             p2,
             p3,
             p4,
             p5,
             top = "Simulated Microplastics Dataset (n = 1e5)",
             ncol = 2)
```

From this distribution of simulated microplastics in drinking water, the 1-10 micron fraction will be considered bioavailable.
```{r}
summaryDistribution <- df2 %>% 
  group_by(size.category) %>% 
  dplyr::summarize("Min Mass (mg)" = signif(min(mass.mg),3),
                   "Average Mass (mg)" = signif(mean(mass.mg),3),
                   "Max Mass (mg)" = signif(max(mass.mg),3),
                   "Particles" = n(),
                   "fraction of 1-5,000um microplastics" = n()/sum(n),
                   ) %>% 
  adorn_totals()

kable(summaryDistribution)
```

The bioavailable fraction (1-10 um) for tap water is 0.75 (alpha = 1.6) or 0.971 (alpha = 2.5).

```{r}
summaryDistribution$`Average Mass (mg)`[1]
```

The average mass for the 1-10 micron fraction is 9.65 x 10^-8 mg if alpha = 1.6; and 3.42 x 10^-8 if alpha = 2.5.

### Tap Water
```{r}
n = 10000
## Generate values for the three distributions
set.seed(123)

##++++++++++++++++++++++++++++++++++++++++
## SIZE DISTRIBUTION
##++++++++++++++++++++++++++++++++++++++++

xmin = 1 #UM
alpha = alpha #2.7 is preferred in unpublished Kooi et al.

X.func <- function (X){
  success <- FALSE
  while (!success){
    U = runif(1, 0, 1)
    X = xmin*(1-U)^(1/(1-alpha))
    success <- X < 5000} ##should be smaller than 5000 um 
  return(X)
}

# create data frame
Data <- data.frame(Size = numeric(0))

for(i in 1:n){
  X <- X.func()
  Data <- rbind(Data, X)
}

colnames(Data) <- c("Size")

min(Data$Size) ##20 um
max(Data$Size) ##5000 um


##++++++++++++++++++++++++++++++++++
##### Occurrence Distribution #####
##+++++++++++++++++++++++++++++++++
#bimodal
#exposure sources are in logarithmic concentrations$

mu1 <- 1.44
mu2 <- 2.66
sd1 <- 0.99
sd2 <- 0.13
lambda1 <- 0.68
lambda2 <- 0.32


#Sample N random uniforms U
U =runif(n)

#Sampling from the mixture
for(i in 1:n){
  if(U[i]<lambda1){
    Data$TapWater.log.particles.L [i] = rtnorm(1,mu1,sd1, lower = 0) #, upper = 1)
  }else{
    Data$TapWater.log.particles.L[i] = rtnorm(1,mu2,sd2, lower = 0) #, upper = 1)
  }
}

Data <- Data %>% mutate(TapWater.particles.L = 10^(TapWater.log.particles.L))
```
```{r}
min(Data$TapWater.log.particles.L) ##0
max(Data$TapWater.log.particles.L) ## 5.260823
ggplot(Data, aes(x = TapWater.particles.L, fill = Size)) + 
  geom_histogram(aes(y = ..ncount..),bins = 75, alpha = 0.7) +#, fill = "royalblue2") + 
  scale_x_log10(name = "Log Concentration (particles/L)") +
  ggtitle("Tap Water Distribution") +
  theme_minimal(base_size = 15)
```


## Summary Table
```{r paged.print=TRUE}
# Static import of median and 95th percentile exposure

MediaSummary <- data.frame(
  Media = c("Drinking Water", "Fish", "Mollusc", "Crustacean", "Bottled Water", "Salt", "Beer", "Milk", "Air"),
  Units = c("Particles/L", "Particles/g BWW", "Particles/g TWW", "Particles/g BWW", "Particles/L", "Particles/kg", "Particles/L", "Particles/L", "Particles/m<sup>3</sup>"),
  #mean = c(mean(Data$TapWater.particles.L)), 
  median = c(median(Data$TapWater.particles.L), 10^-0.73, 10 ^ 0.91, 10 ^0.38, 10^2.53, 10^3.11, 10^2.12, 10^2.12, 10^1.56), 
  UCL95 = c(quantile(Data$TapWater.particles.L,probs = 0.95)[[1]], 10 ^ 1.79, 10^2.63, 10^2.11, 10^3.97, 10^5.08,10^3.55, 10^3.51,10^4.28 )
  )

kable(MediaSummary,
      col.names = c("Media", "Units", "Median", "Upper 95th Percentile"),
      digits = 1,
      caption = "Means and Percentiles of Exposure Media of Microplastics based on Modeled Concentrations from Nur Mohamed et al (2021)"
      )
```


```{r eval=FALSE, include=FALSE}
ingestionSummary <- data.frame(
  Parameter = c("Drinking Water", "Fish", "Mollusc", "Crustacean", "Bottled Water", "Salt", "Beer", "Milk", "Air"),
  Units = c("Fish Ingestion Rate", "Particles/g BWW", "Particles/g TWW", "Particles/g BWW", "Particles/L", "Particles/kg", "Particles/L", "Particles/L", "Particles/m<sup>3</sup>"),
  #mean = c(mean(Data$TapWater.particles.L)), 
  median = c(median(Data$TapWater.particles.L), 10^-0.73, 10 ^ 0.91, 10 ^0.38, 10^2.53, 10^3.11, 10^2.12, 10^2.12, 10^1.56), 
  UCL95 = c(quantile(Data$TapWater.particles.L,probs = 0.95)[[1]], 10 ^ 1.79, 10^2.63, 10^2.11, 10^3.97, 10^5.08,10^3.55, 10^3.51,10^4.28 )
  )

kable(MediaSummary,
      col.names = c("Media", "Units", "Median", "Upper 95th Percentile"),
      digits = 1,
      caption = "Means and Percentiles of Exposure Media of Microplastics based on Modeled Concentrations from Nur Mohamed et al (2021)"
      )
```




# Critical Effect Determination and Reference Level Calculations


OEHHA develops health-protective concentrations using the general approach of the Public Health Goal (PHG) program for developing health-protective concentrations of chemicals in drinking water that are expected to result in no adverse effects from exposure over a lifetime. For noncancer effects, the derivation of the health-protective concentration starts with the PODs derived from animal or human studies. This dose is converted to an acceptable daily dose (ADD), which is then back calculated to a health protective concentration in drinking water. Because there were no studies of the carcinogenicity of microplastics, only a noncancer health-protective concentration was derived.

OEHHA evaluated the health outcomes of the most sensitive animal toxicity studies available in the literature for health-protective concentration derivation. In the XXX studies selected as candidate critical studies (Table 1), the health outcomes included effects on reproductive organs and tissues following oral exposure to polystyrene microplastic particles. From these identified targets of microplastics, the MALE GONADS?? were found to be the most sensitive to microplastics-induced toxicity. These target organs are the same as those identified by XXXXXX. As discussed in the following sections, OEHHA identified the thyroid as the most sensitive for health-protective concentration derivation.

<DESCRIBE STUDY DETAILS BREIFY HERE>

## Critical Effect Determination
Table 1 lists the PODs (both NOAELs and BMDLs) derived from the studies OEHHA identified as suitable for quantitative dose-response analysis and health-protective concentration derivation. The results from animal toxicity studies of microplastics in mice and rats support the human testes as a potential target organ of microplastics, and the measured effects in the XXXX were found to be more sensitive than in the XXXX. Spermatogenesis and sperm motility disruption from the Xie et al (2020), Huo et al (2021) and Amereh et al (2020) studies were the most sensitive endpoints in the microplastics animal toxicity database, and both were considered for health-protective concentration derivation.


# Health-Protective Concentration Calculation

## Human Equivalent Dose (HED)

To derive a human equivalent dose (HED) from the animal POD, probabilistic particokinetic estimates from Mohamed Nor et al (2021) were utilized. The methods employed by Mohamed Nor et al (2021) are briefly described here.

Microplastics tissue removal, C<sub>tis</sub> (particles/capita), is modeled as biliary excretion through the gastrointestinal tract (Term C in equation 1. and term three in equation 2). Since the biliary excretion rate constant, k<sub>tis</sub>(day<sup>-1</sup>), is unknown for humans and microplastics, values based on three rodent studies on sub-micron particles (<1 um) were used with the assumption that the transfer rate is similar for both microplastics and nanoparticles, which are both capable of accessing organs and penetrating cell membranes. Loss of microplastics via egestion was estimated using stool frequencies with an assumption that microplastics do not get trapped in the gastrointestinal tract. 

Equation 1. $\frac{dC_{MP}}{dt} = (1-f_{abs} \cdot f_{a,n}) \sum_{i = 1}^{n} (Ir_i \cdot C_i) + (1 - f_{abs}) (f_{dep} \cdot lnR \cdot C_a) + k_{tis} \cdot C_{tis} - k_{loss} \cdot C_{MP}$

*CAN WE CALCULATE A DOSE ADJUSTMENT FACTOR?*

To derive the POD<sub>Human</sub>, divide the animal POD by the DAF:

$POD_{Human} = \frac{LOD_{animal} (mg/kg-day)}{DAF (unitless)}$

## Acceptable Daily Dose (ADD)
An ADD is the estimated maximum daily dose of a chemical (in mg/kg-day) that can be consumed by a human for an entire lifetime without adverse effects. To determine the ADD, the POD is adjusted by factors to account for uncertainties in the risk assessment, such as differences between animals and humans (interspecies extrapolation), and differences among humans (intraspecies variation, including sensitive subgroups) in response to a chemical exposure. Additionally, factors may be applied to extrapolate from subchronic to chronic exposure duration, from LOAEL to NOAEL when a NOAEL or BMDL is not available, and also when the toxicity database is incomplete. These factors combined are referred to as the composite uncertainty factor (UF).

When developing health-protective concentrations for noncancer effects based on animal toxicity studies, OEHHA generally applies a composite UF of 300, consisting of 10 for interspecies extrapolation (√10 for pharmacokinetics and √10 for
pharmacodynamics) and 30 for intraspecies variability (10 for pharmacokinetics and √10 for pharmacodynamics) (OEHHA, 2008). A detailed description of these factors is presented in Appendix XXX. 

When calculating the ADD for microplastics using the POD from Xie et al. (2020), OEHHA applied an interspecies UF of √10 to account for potential differences in particodynamics when extrapolating data from animal studies to humans. Because microplastics are not known to be metabolized in animals or humans, and because a particokinetic adjustment was applied to the animal POD to derive a human equivalent dose, the particokinetic components of the interspecies and intraspecies UFs were reduced by √10 each. Therefore, the intraspecies UF was reduced from OEHHA’s default of 30 to 10 to account for human variability. Additionally, an additional UF of √10 was applied for database deficiencies, most notably the absence of a chronic toxicity study. This resulted in a composite UF of 100.

An uncertainty factor of 10 for interspecies extrapolation is applied due to lack of data for converting between animal and human studies for microplastics. An uncertainty factor of 30 is appliaed for intraspecies variability. An unceratinty factor of 10 for LOAEL to NOAEL is used. Although the critical threshold study was subchronic (<8% of the animal's lifetime), no uncertainty factors were applied to convert to chronic because the 35-day exposure covers an entire sperm cycle (from spermatogonia to mature spermatozoa).

A database deficiency UF of √10 was added, as a chronic exposure study may result in more severe effects than what was detected in Xie et al. (2020). In addition, it is not known whether chronic exposure would result in other effects that occur at lower doses than the observed changes in immune system and reproductive function in adult animals. Additionally, other deficiencies in the database besides chronic exposure studies exist for microplastics. *describe unknowns here*

To calculate the ADD, divide the POD<sub>Human</sub> by the composite UF:

$ADD = \frac{POD_{human} (mg/kg-day)}{UF}$

$ADD = \frac{POD_{human} (0.017 mg/kg-day)}{UF (3,000)} = 5.7 x 10^{-6} mg/kg-day$

## Relative Source Contribution

In estimating health-protective levels of chemicals in drinking water for noncancer endpoints, OEHHA considers the relative source contribution (RSC), which is the proportion of exposures to a chemical attributed to tap water as part of total exposure from all sources, including food and ambient air. When developing an appropriate RSC value for a chemical, OEHHA follows US EPA’s Exposure Decision Tree Approach (US EPA, 2000). This approach takes into account the availability of exposure data, including the levels and relevant sources of exposure, and any other non-water regulatory standards for the chemical. In addition, any specific subpopulations of concern are identified and considered in the process. A chemical-specific RSC value can be calculated when adequate data are available for all sources of exposure, including exposures from drinking water. If data are not adequate for determining the contribution of one or more of these non-water exposure sources, then default values may be used (US EPA, 2000). The default estimates include a low estimate of 20% and a high estimate of 80%, used when data are not otherwise available to better characterize sources of exposure.

For microplastics, the population of concern is all residents of California. Relevant exposure sources to Californians include environmental media and consumer products. However,the availability of data to quantify microplastics exposure from these sources is limited. Microplastics have been detected in household dust, air, seafood (fish, molluscs, crustaceans), salt, bottled water, beer, milk, and tap water - all of which are consumed on a daily basis (Mohamed Nor et al 2021). Frequency of detection and concentrations measured varied widely by study and products tested. Further, no standardized analytical methods exist. Mohamed Nor et al (2021) estimated dietary exposures from microplastics ranged from *MIN* ng/kg-day (minimum) to *Max* ng/kg-day (maximum).

While there is limited data quantifying the levels of microplastics in some items (particularly fruits, vegetables, grains, meat, and processed foods), microplastics aare a ubiquitous environmental contaminant and the potential exposure sources are extensive. Because there is insufficient human data to assess the population’s exposure to microplastics from all sources other than tap water, a default RSC of 20% was selected and is consistent with the US EPA (2000) guidance.

### Drinking Water Intake

To calculate a health-protective concentration for a chemical, the ADD is converted to a concentration in drinking water that accounts for the total exposure to the chemical that people receive from using tap water. It includes intake from ingestion, inhalation, and dermal contact with contaminants in tap water from household uses (e.g., drinking, cooking, bathing, and showering). Inhalation exposure can take place when a chemical volatilizes out of the water during cooking or showering. Dermal absorption of the chemical can occur during bathing and other household uses of tap water.

The daily water intake equivalent (DWI) is expressed in the units of liters or liter equivalents per kilogram of body weight per day (L/kg-day or Leq/kg-day, respectively). Liter equivalents represent the equivalent of the amount of tap water one would have to drink to account for the exposure to a chemical in tap water through oral, inhalation, and dermal routes. For oral intake rates, the PHG program uses age-specific water ingestion estimates (OEHHA, 2012) derived from a nationwide survey of food and beverage intake from approximately 20,000 people (US Department of Agriculture’s Continuing Survey of Food Intake of Individuals 1994-1996, 1998 dataset). These age-specific intake rates are normalized to body weight and expressed as L/kg-day.

Microplastics exposure from tap water is expected to be predominately from oral exposure. *Volatilization is negligible ref* *dermal exposure is negligible ref.*

The 70-yr lifetime weighted average (0.053 L/kg-day) drinking water intake (DWI) rate is used. for health-protective concentration. *explain why susceptible*. Also, infants have higher exposure to drinking water contaminants because they consume more water (when fed reconstituted formula) on a body weight basis than adults. 

### Health-Protective Concentration

$C = ADD x RSC \div DWI$, where:
ADD = acceptable daily dose (mg/kg-day),
RSC = relative source contribution of 0.2, and
DWI = daily water intake rate (L/kg-day)

```{r}
ADD = 5.7E-6
RSC = 0.2
DWI = 0.053
CF = 1000 #correction factor mg to ug
C = ((ADD * RSC) / DWI) * CF
paste("Health Protective Concentration:", round(C,3), "ug/L (ppb)")
```
$C = ADD (5.7 x 10^{-6} mg/kg-day) * RSC (0.2) \div DWI (0.053 L/kg-day) * 1,000 (ug/mg) =  0.022 ug/L (ppb)$

The mass of a 5 micron polystyrene sphere that was used in the Hou et al (2021) study may be estimated by first calculating the volume of a perfect sphere:

$V = \frac{4}{3}{\pi}r^3$

Where r = radius (length/2; 2.5 um).
```{r}
particle.volume = (4/3)*pi*2.5^3
paste(round(particle.volume,1), "um3")
```
Particle mass may then be calculated as follows:

$m = pV*\frac{1}{1e12}*1000$

Where *m* is the mass (mg), *p* is density (g/cm^3; 1.05 for polystyrene), *V* is volume (um^3) - which is calculated by the cube of the length (um) of each particle, and additional conversion factors for mg to g (x1000) and cm^3 to um^3 (1e-12).
```{r}
polystyrene.density = 1.05 #g/cm^3
particle.mass.ug = polystyrene.density * particle.volume * 1e-12 * 1000 * 1000 # ug
paste(signif(particle.mass.ug,3),"ug/particle")
```
The number of 5 micron polystyrene spherical particles for the health-protective concentration in drinking water may then be estimated by dividing the mass-based health-protective concentration (0.022 ug/L) by the mass/particle (ug/particle) of 5 um polystyrene spheres. 

```{r}
C.part.L.5um.PS.spheres = C / particle.mass.ug 
paste(signif(C.part.L.5um.PS.spheres,3),"5-um Polystyrene Spherical Particles/L")
```
This value can now be aligned to a 1-10 micron size range using equation 3 in Mohamed Nor et al (2021).

<!-- # ```{r} -->
<!-- # #function to derive correction factor (CF) -->
<!-- # CFfnx = function(a = 2.5, # Suggested value from Merel -->
<!-- #                  x2D = 10, #upper size range for drinking water -->
<!-- #                  x1D = 1, #1 um is lower default size -->
<!-- #                  x2M, x1M){ -->
<!-- # -->
<!-- #   CF = (x2D^(1-a)-x1D^(1-a))/(x2M^(1-a)-x1M^(1-a)) -->
<!-- # -->
<!-- #   return(CF) -->
<!-- # } -->
<!-- # #do for 5 um particles -->
<!-- # CFfnx(x1M = 4.9, x2M = 5.01) -->
<!-- # x1M = 4.9 -->
<!-- # x2M = 5.1 -->
<!-- # -->
<!-- # Data2 <- Data %>% -->
<!-- #   mutate(CF = CFfnx(x1M = x1M, x2M = x2M)) %>%  #create new column with correction factor -->
<!-- #   mutate(TapWater.particles.L.corrected = CF * TapWater.particles.L) #convert single concenetrations -->
<!-- # ``` -->

# CONVERT ALL PARTICLES IN DRINKING WATER TO MASS/L #

Based on the average mass of 1-10 micron microplastic particles in drinking water (5.65 x 10^-6 ug/particle) (Mohamed Nor et al 2021).Correcting the simulated distribution of 1-5,000 micron microplastics particles for the bioavailable fraction of 1-10 micron particles (0.97) in global drinking water estimates, this threshold translates to approximately:

```{r}
# 9.65 x 10^-8 mg from above
### Comment out particle.mass.ug and replace with summaryDistribution to rever
ug.Particle.drinkingWater = particle.mass.ug  # summaryDistribution$`Average Mass (mg)`[1] * 1000 #ug to mg  #5.65e-06 #calcaulated mean value from Hazimah

#summaryDistribution$`Average Mass (mg)`[1] * 1000 #ug to mg
#5.65e-6 ug/particle from Bart's paper

frac.bioavailable.summary = summaryDistribution$`fraction of 1-5,000um microplastics`[1] #based on above table

C.part.L = (C / ug.Particle.drinkingWater) * frac.bioavailable.summary #bioavailable correction for 1-5,000 um particles
Data <- cbind(Data, C.part.L)
paste("Health Protective Concentration:", round(C.part.L,1), "particles/L")
```

# Risk Characterization


```{r}
minExposureChild.mg.capita.day = 1.28e-7
medianExposureChild.mg.capita.day = 1.84e-4
maxExposureChild.mg.capita.day = 7.5

minExposureAdult.mg.capita.day = 3.28e-7
medianExposureAdult.mg.capita.day = 5.83e-4
maxExposureAdult.mg.capita.day = 17

medianExposureAdult.mg.capita.day.inhalation = 1e-7
medianExposureChild.mg.capita.day.inhalation = 1e-7
minExposureAdult.mg.capita.day.inhalation = 1e-11
minExposureChild.mg.capita.day.inhalation = 1e-11
maxExposureAdult.mg.capita.day.inhalation = 5e-2
maxExposureChild.mg.capita.day.inhalation = 5e-2

totalExposure <- data.frame(Adult.Child = c("Adult", "Child"),
                            minTotalExposure.mg.capita.day = c(minExposureAdult.mg.capita.day, minExposureChild.mg.capita.day),
                            medianTotalExposure.mg.capita.day = c(medianExposureAdult.mg.capita.day, medianExposureChild.mg.capita.day),
                            maxTotalExposure.mg.capita.day = c(maxExposureAdult.mg.capita.day, maxExposureChild.mg.capita.day),
                            medianExposure.mg.capita.day.inhalation = c(medianExposureAdult.mg.capita.day.inhalation, medianExposureChild.mg.capita.day.inhalation),
                            minExposure.mg.capita.day.inhalation = c(minExposureAdult.mg.capita.day.inhalation, minExposureChild.mg.capita.day.inhalation),
                            maxExposure.mg.capita.day.inhalation = c(maxExposureAdult.mg.capita.day.inhalation, maxExposureChild.mg.capita.day.inhalation),
                            averageBodyMass.kg = c(80,37) #based on air Toxis Table 10.1
                            )

totalExposure.summary <- totalExposure %>% 
  mutate(medianTotalExposure.mg.kg.day = medianTotalExposure.mg.capita.day / averageBodyMass.kg) %>% 
  mutate(minTotalExposure.mg.kg.day = minTotalExposure.mg.capita.day / averageBodyMass.kg) %>%
  mutate(maxTotalExposure.mg.kg.day = maxTotalExposure.mg.capita.day / averageBodyMass.kg) %>% 
  mutate(medianTotalExposure.mg.kg.day.no.air = medianTotalExposure.mg.kg.day - medianExposure.mg.capita.day.inhalation) %>% 
  mutate(maxTotalExposure.mg.kg.day.no.air = maxTotalExposure.mg.kg.day - maxExposure.mg.capita.day.inhalation) %>% 
  mutate(minTotalExposure.mg.kg.day.no.air = minTotalExposure.mg.kg.day - minExposure.mg.capita.day.inhalation)

totalExposure.summary  
```

Acceptable Daily Dose (mg/kg-day) may also be expressed as mg/capita-day for children and adults by multiplying OEHHA's default values for body weight by the ADD. These values are 80 kg for adults, and 37 kg for children.

```{r}
ADD.Child = ADD * 37
ADD.Adult = ADD * 80
paste("child ADD:", signif(ADD.Child,3), "mg/capita-day")
paste("adult ADD:", signif(ADD.Adult,3), "mg/capita-day")
```


```{r}
totalExposure.summary %>% 
  ggplot(aes(x = Adult.Child, y = medianTotalExposure.mg.kg.day.no.air, color = Adult.Child)) +
  geom_point(size = 9) +
  geom_errorbar(aes(ymin = minTotalExposure.mg.kg.day.no.air, ymax = maxTotalExposure.mg.kg.day.no.air, width = 0.6)) +
  scale_color_manual(values=c('#999999','#E69F00')) +
  geom_hline(yintercept = ADD, color = "red", linetype = "dashed", size = 1.5) + 
  geom_text(aes(y = ADD + 1.4*ADD, x = 0.70), label = paste0("Acceptable Daily Dose:", ADD, " mg/kg-day"), color = "red") +
  scale_y_log10(name  = "Total Estimated Microplastics Exposure (mg/kg-day)") +
  labs(title = "Microplastics Risk Characterization (Deterministic)",
       subtitle ="Acceptable Daily Dose in Dotted Red Line; Ingestion Exposure Only (no inhalation)",
       caption = "Median, Min, and Max exposure estimates Based on Mohamed Nor et al (2021)") +
  dark_theme_minimal(base_size = 15) +
  #theme_minimal(base_size = 15) +
  theme(axis.title.x = element_blank(),
    plot.title = element_text(hjust = 0.5, face="bold"),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "none"
  )
```


```{r}
#correct for bioavailability
Data2 <- Data %>% 
  mutate(frac.bioavailable = frac.bioavailable.summary) %>%  #bioavailable correction for 1-5,000 um particles
  mutate(TapWater.particles.L.bioavailable = TapWater.particles.L * frac.bioavailable) %>% 
  mutate(aboveC = factor(case_when(
    TapWater.particles.L.bioavailable >= (10 * C.part.L) ~ "above RL",
    TapWater.particles.L.bioavailable >= C.part.L ~ "above NL",
    TapWater.particles.L.bioavailable < C.part.L ~ "below NL",
  )))
  
#calculate exceedance
exceedance <- Data2 %>%
  dplyr::select(c(TapWater.particles.L.bioavailable, aboveC)) %>%
  group_by(aboveC) %>%
  dplyr::summarize(Freq = n() / sum(n))
```

```{r}
#plot
ggplot(Data2, aes(x = TapWater.particles.L.bioavailable, fill = aboveC)) + 
  geom_histogram(aes(y = ..count../sum(..count..)),bins = 50, alpha = 0.9, position = "identity") + 
  geom_vline(xintercept = C.part.L, color = "goldenrod2", linetype = "dashed") +
  geom_vline(xintercept = 10 * C.part.L, color = "tomato1", linetype = "dashed") +
  geom_text(aes(x = C.part.L, y = 0.10), label = "Health Protective Concentration (NL)", color = "goldenrod2") +
  geom_text(aes(x = 10 * C.part.L, y = 0.07), label = "Response Level (10x NL)", color = "tomato1") +
  geom_text(aes(x = C.part.L, y = 0.09), label = paste(100*round(exceedance$Freq[1],4), "% Above NL"), color = "goldenrod2") +
  geom_text(aes(x = 10* C.part.L, y = 0.06), label = paste(100 * round(exceedance$Freq[2],4), "% Above RL"), color = "tomato1") +
  scale_x_log10(name = "Concentration of 1-10 micron microplastics (particles/L)") +
   scale_y_continuous(name = "Relative Frequency") +
  scale_fill_manual(values = c("above RL" = "tomato1", "below NL"= "cyan3", "above NL" = "goldenrod2")) +
  labs(title = "Microplastics in Tap Water Distribution (Particles/L; 1- 10 um)",
       subtitle ="Health-Protective Concentration in Dotted Yellow Line",
       caption = paste0("Based on Probability Density Functions in Mohamed Nor et al (2021); alpha = ",alpha, "; average mass of particle in drinking water = ", signif(ug.Particle.drinkingWater,2), " ug/particle")
       )+
  dark_theme_minimal(base_size = 15) +
  #theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold"),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "none"
  )
```

Alternatively, the concentration of microplastics in tap water can be displayed in estimated mass (ug/L) alongside the health-protective concentration. By

```{r}
#correct for bioavailability
Data3 <- Data %>% 
  mutate(frac.bioavailable = frac.bioavailable.summary) %>%  #bioavailable correction for 1-5,000 um particles
  mutate(tapWater.ug.L = TapWater.particles.L * ug.Particle.drinkingWater) %>% 
  mutate(tapWater.ug.L.bioavailable = tapWater.ug.L * frac.bioavailable) %>% 
  mutate(aboveC = factor(case_when(
    tapWater.ug.L.bioavailable >= (10 * C) ~ "above RL",
    tapWater.ug.L.bioavailable >= C ~ "above NL",
    tapWater.ug.L.bioavailable < C ~ "below NL"
  )))
  
  
#calculate exceedance
exceedance <- Data3 %>%
  dplyr::select(c(tapWater.ug.L, aboveC)) %>%
  group_by(aboveC) %>%
  dplyr::summarize(Freq = n() / sum(n))

#plot
ggplot(Data3, aes(x = tapWater.ug.L.bioavailable, fill = aboveC)) + 
  geom_histogram(aes(y = ..count../sum(..count..)),bins = 80, alpha = 0.9, position = "identity") + 
  geom_vline(xintercept = C, color = "red", linetype = "dashed") +
  geom_text(aes(x = C, y = 0.1), label = "Health Protective Concentration") +
  geom_text(aes(x = C, y = 0.09), label = paste(100*round(exceedance$Freq[1],4), "% Above Threshold")) +
  scale_x_log10(name = "Concentration of 1-10 micron microplastics (ug/L)") +
  scale_y_continuous(name = "Relative Frequency") +
  labs(title = "Microplastics in Tap Water Distribution (ug/L; 1 - 10 um)",
       subtitle ="Health-Protective Concentration in Dotted Red Line",
       caption = "Based on Probability Density Functions in Mohamed Nor et al (2021)") +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold"),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "none"
  )
```



Cumulative Density Function
```{r}
ECDF.tapWater <- Data2 %>% 
  ggplot(aes(x = TapWater.particles.L.bioavailable))+
  #stat_ecdf(geom = "point", size = 2) +
  stat_ecdf(geom = "step", linetype = 'solid', alpha = 0.6, size = 1.5, color = "slateblue") +
  scale_color_manual(values = wes_palette("GrandBudapest2"))+
    geom_vline(xintercept = C.part.L, color = "red", linetype = "dashed") +
  geom_text(aes(x = C.part.L, y = 0.1), label = "Health Protective Concentration") +
  ylab("Cumulative Density") +
  xlab("Particles/L (1-20 um)")+
  scale_y_continuous(labels = scales::percent)+
  scale_x_continuous(trans = "log10") +
  annotation_logticks(sides = "b") +  #log scale rick marks on bottom
    labs(title = "Microplastics in Tap Water Distribution (Particles/L; 1-20 um) ECDF",
       subtitle = "Particles/L corrected to 1-5,000 um, bioavailable fraction show (1-20 um)",
       caption = "Based on Probability Density Functions in Mohamed Nor et al (2021)") +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold"),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "none"
  )

ECDF.tapWater
```


# References
OEHHA (2008). Air Toxics Hot Spots Risk Assessment Guidelines: Technical Support Document for the Derivation of Noncancer Reference Exposure Levels. Office of Environmental Health Hazard Assessment, California Environmental Protection Agency, Sacramento, California. 










